<!-- src/app/features/admin/response-dialog/response-dialog.component.html -->
<div class="response-dialog">
  <h2 mat-dialog-title>
    <mat-icon>reply</mat-icon>
    R√©pondre √† {{ data.message.fullName }}
  </h2>

  <mat-dialog-content class="dialog-content">
    <!-- Informations du contact -->
    <mat-card class="contact-info">
      <mat-card-header>
        <mat-card-title>Informations du contact</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="contact-details">
          <p><strong>Email :</strong> {{ data.message.email }}</p>
          <p><strong>Sujet :</strong> {{ getSubjectLabel(data.message.subject) }}</p>
          <p><strong>Date :</strong> {{ data.message.createdAt | date:'dd/MM/yyyy √† HH:mm' }}</p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Message original -->
    <mat-card class="original-message">
      <mat-card-header>
        <mat-card-title>Message original</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p class="message-text">{{ data.message.message }}</p>
      </mat-card-content>
    </mat-card>

    <!-- Formulaire de r√©ponse -->
    <mat-card class="response-form-card">
      <mat-card-header>
        <mat-card-title>Votre r√©ponse</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="responseForm" class="response-form">
          
          <!-- Option d'envoi d'email -->
          <mat-checkbox formControlName="sendEmail" color="primary" class="email-option">
            <div class="checkbox-label">
              <mat-icon>email</mat-icon>
              Envoyer la r√©ponse par email √† <strong>{{ data.message.email }}</strong>
            </div>
          </mat-checkbox>

          <!-- Champ de r√©ponse -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Votre r√©ponse</mat-label>
            <textarea matInput formControlName="response" rows="8"
                      placeholder="R√©digez votre r√©ponse ici..."></textarea>
            <mat-hint align="end">
              {{ response?.value?.length || 0 }} caract√®res
            </mat-hint>
            <mat-error *ngIf="response?.hasError('required') && response?.touched">
              La r√©ponse est obligatoire
            </mat-error>
            <mat-error *ngIf="response?.hasError('minlength') && response?.touched">
              La r√©ponse doit contenir au moins 10 caract√®res
            </mat-error>
          </mat-form-field>

          <!-- Aper√ßu de l'email -->
          <div *ngIf="responseForm.get('response')?.value && responseForm.get('sendEmail')?.value" 
               class="email-preview">
            <h4>üìß Aper√ßu de l'email qui sera envoy√© :</h4>
            <div class="preview-container" [innerHTML]="getEmailPreview()"></div>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="isSubmitting">
      <mat-icon>cancel</mat-icon>
      Annuler
    </button>
    <button mat-raised-button color="primary" 
            (click)="onSend()" 
            [disabled]="responseForm.invalid || isSubmitting"
            class="send-button">
      <mat-icon *ngIf="!isSubmitting">send</mat-icon>
      <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
      {{ isSubmitting ? 'Envoi en cours...' : 'Envoyer la r√©ponse' }}
    </button>
  </mat-dialog-actions>
</div>
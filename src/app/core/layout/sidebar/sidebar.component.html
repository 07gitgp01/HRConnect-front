<mat-nav-list class="app-sidebar">
  @if (currentUser$ | async; as user) {
    
    <!-- Header avec infos utilisateur -->
    <div class="user-profile-section">
      <div class="user-avatar">
        <mat-icon>person</mat-icon>
      </div>
      <div class="user-info">
        <div class="user-name">{{ user.nom || user.prenom || user.email }}</div>
        <div class="user-role">{{ getRoleLabel(user.role) }}</div>
        
        <!-- Afficher les types de partenaire si applicable -->
        @if (user.role === 'partenaire' && user.partenaireData) {
          <div class="user-types">
            <span class="user-type-label">{{ getPartenaireTypesDisplay(user.partenaireData) }}</span>
            @if (aPlusieursTypes(user)) {
              <mat-chip class="multi-type-badge" color="primary" variant="outlined">
                {{ user.partenaireData.typeStructures.length }} type(s)
              </mat-chip>
            }
          </div>
          
          <!-- Indicateurs de r√¥les -->
          <div class="role-indicators">
            @if (estPTF(user)) {
              <span class="role-indicator ptf-indicator">
                <mat-icon>account_balance</mat-icon>
                PTF
              </span>
            }
            @if (estStructureAccueil(user)) {
              <span class="role-indicator structure-indicator">
                <mat-icon>business</mat-icon>
                Structure d'Accueil
              </span>
            }
          </div>
        }
      </div>
    </div>

    <mat-divider class="profile-divider"></mat-divider>

    <!-- üßë‚Äçüíº MENU ADMINISTRATEUR -->
@if (user.role === 'admin') {
  <div class="menu-section">
    <div class="menu-section-title">
      <mat-icon class="section-icon">admin_panel_settings</mat-icon>
      <span>Administration</span>
    </div>

    <a mat-list-item routerLink="/features/admin" routerLinkActive="active">
      <mat-icon matListItemIcon>dashboard</mat-icon>
      <span matListItemTitle>Tableau de Bord</span>
    </a>

    <a mat-list-item routerLink="/features/admin/projets" routerLinkActive="active">
      <mat-icon matListItemIcon>assignment</mat-icon>
      <span matListItemTitle>Gestion Projets</span>
    </a>

    <a mat-list-item routerLink="/features/admin/volontaires" routerLinkActive="active">
      <mat-icon matListItemIcon>people</mat-icon>
      <span matListItemTitle>Gestion Volontaires</span>
    </a>

    <a mat-list-item routerLink="/features/admin/candidatures" routerLinkActive="active">
      <mat-icon matListItemIcon>how_to_reg</mat-icon>
      <span matListItemTitle>Gestion Candidatures</span>
    </a>

    <a mat-list-item routerLink="/features/admin/partenaires" routerLinkActive="active">
      <mat-icon matListItemIcon>handshake</mat-icon>
      <span matListItemTitle>Gestion Partenaires</span>
    </a>

    <!-- NOUVEAU : Gestion des rapports PTF -->
    <a mat-list-item routerLink="/features/admin/rapports-ptf" routerLinkActive="active">
      <mat-icon matListItemIcon>description</mat-icon>
      <span matListItemTitle>Rapports PTF</span>
    </a>

    <!-- NOUVEAU : Gestion des rapports Structures -->
    <a mat-list-item routerLink="/features/admin/rap-struct" routerLinkActive="active">
      <mat-icon matListItemIcon>description</mat-icon>
      <span matListItemTitle>Rapports Structures</span>
    </a>

    <!-- <a mat-list-item routerLink="/features/admin/admins" routerLinkActive="active">
      <mat-icon matListItemIcon>admin_panel_settings</mat-icon>
      <span matListItemTitle>Gestion Admins</span>
    </a> -->

    <a mat-list-item routerLink="/features/admin/comptes" routerLinkActive="active">
      <mat-icon matListItemIcon>supervised_user_circle</mat-icon>
      <span matListItemTitle>Comptes candidats</span>
    </a>

    <!-- üîî BO√éTE DE MESSAGERIE AVEC BADGE DES NOUVEAUX MESSAGES -->
    <a mat-list-item routerLink="/features/admin/messages" routerLinkActive="active" class="message-item">
      <mat-icon matListItemIcon>mail</mat-icon>
      <span matListItemTitle>Bo√Æte de Messagerie</span>
      
      <!-- Badge pour les nouveaux messages -->
      @if (newMessagesCount$ | async; as count) {
        @if (count > 0) {
          <div class="message-badge-container">
            <mat-badge 
              matBadge="{{count}}" 
              matBadgeColor="warn"
              matBadgeSize="small"
              [class.high-count]="count > 9"
              class="message-badge">
            </mat-badge>
          </div>
        }
      }
    </a>
  </div>
}

    <!-- üë®‚Äçüéì MENU CANDIDAT -->
    @if (user.role === 'candidat') {
      <div class="menu-section">
        <div class="menu-section-title">
          <mat-icon class="section-icon">school</mat-icon>
          <span>Espace Candidat</span>
        </div>

        <a mat-list-item routerLink="/features/candidats/" routerLinkActive="active">
          <mat-icon matListItemIcon>home</mat-icon>
          <span matListItemTitle>Tableau de Bord</span>
        </a>

        <a mat-list-item routerLink="/features/candidats/mes-candidatures" routerLinkActive="active">
          <mat-icon matListItemIcon>assignment_turned_in</mat-icon>
          <span matListItemTitle>Mes Candidatures</span>
        </a>

        <a mat-list-item routerLink="/features/candidats/projets" routerLinkActive="active">
          <mat-icon matListItemIcon>search</mat-icon>
          <span matListItemTitle>Projets Disponibles</span>
        </a>
      </div>
    }

    <!-- üè¢ MENU PARTENAIRE AVEC GESTION MULTI-TYPES -->
@if (user.role === 'partenaire') {
  <div class="menu-section">
    <div class="menu-section-title">
      <mat-icon class="section-icon">business</mat-icon>
      <span>Espace Partenaire</span>
    </div>

    <!-- Tableau de bord principal -->
    <a mat-list-item routerLink="/features/partenaires/dashboard" routerLinkActive="active">
      <mat-icon matListItemIcon>dashboard</mat-icon>
      <span matListItemTitle>Tableau de Bord</span>
    </a>

    <!-- Gestion des volontaires -->
    @if (peutGererVolontaires(user)) {
      <a mat-list-item routerLink="/features/partenaires/mes-volontaires" routerLinkActive="active">
        <mat-icon matListItemIcon>people</mat-icon>
        <span matListItemTitle>Mes Volontaires</span>
      </a>

      <a mat-list-item routerLink="/features/partenaires/rapports" routerLinkActive="active">
        <mat-icon matListItemIcon>assignment</mat-icon>
        <span matListItemTitle>Gestion Rapports</span>
      </a>
    }

    <!-- Offres de mission -->
    @if (peutCreerProjets(user)) {
      <a mat-list-item routerLink="/features/partenaires/offres-mission" routerLinkActive="active">
        <mat-icon matListItemIcon>work</mat-icon>
        <span matListItemTitle>Offres de Mission</span>
      </a>
    }

    <!-- Rapports PNVB (visible uniquement pour les PTF) -->
    @if (aAccesZonePTF(user)) {
      <a mat-list-item routerLink="/features/partenaires/rapports-pnvb" routerLinkActive="active">
        <mat-icon matListItemIcon>description</mat-icon>
        <span matListItemTitle>Rapports PNVB</span>
        
        <!-- Badge optionnel pour nouveaux rapports -->
        @if (nouveauxRapportsCount$ | async; as count) {
          @if (count > 0) {
            <div class="rapport-badge-container">
              <mat-badge 
                matBadge="{{count}}" 
                matBadgeColor="accent"
                matBadgeSize="small"
                class="rapport-badge">
              </mat-badge>
            </div>
          }
        }
      </a>
    }

    <!-- Profil partenaire -->
   <!--  <a mat-list-item routerLink="/features/partenaires/profil" routerLinkActive="active">
      <mat-icon matListItemIcon>manage_accounts</mat-icon>
      <span matListItemTitle>Mon Profil</span>
    </a> -->
  </div>
}

    <!-- Section commune (D√©connexion) -->
    <div class="bottom-section">
      <mat-divider></mat-divider>
      <a mat-list-item class="logout-item" (click)="logout()">
        <mat-icon matListItemIcon>logout</mat-icon>
        <span matListItemTitle>D√©connexion</span>
      </a>
    </div>

  } @else {
    <!-- √âtat de chargement -->
    <div class="loading-section">
      <div class="loading-avatar"></div>
      <div class="loading-info">
        <div class="loading-line"></div>
        <div class="loading-line short"></div>
      </div>
    </div>
  }
</mat-nav-list>